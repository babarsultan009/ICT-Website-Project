<!DOCTYPE html>
<html>
<head>
  <title>Spotify Dashboard</title>
  <style>
    body {
      background:#078d24;
      color:rgb(11, 5, 8);
      font-family:Arial;
      padding:20px;
    }
    .profile {
      display:flex;
      align-items:center;
      gap:20px;
    }
    img {
      border-radius:50%;
      width:80px;
    }
    .playlist, .search-result {
      margin-top:20px;
      background:#181818;
      padding:15px;
      border-radius:10px;
    }
    input[type="text"] {
      padding:8px;
      width:250px;
      border-radius:5px;
      border:none;
      margin-right:10px;
    }
    button {
      padding:8px 12px;
      border:none;
      border-radius:5px;
      background:rgb(86, 0, 161);
      color:white;
      cursor:pointer;
    }
  </style>
</head>
<body>

<div class="profile" id="profile"></div>

<h2>Search Spotify Songs</h2>
<input type="text" id="searchInput" placeholder="Search for a song...">
<button onclick="searchSpotify()">Search</button>

<div id="searchResults"></div>

<h2>Your Playlists</h2>
<div id="playlists"></div>

<script src="spotify.js"></script>
<script>
async function loadDashboard() {
    const token = localStorage.getItem("access_token");
    if (!token) return;

    // PROFILE
    const profileRes = await fetch("https://api.spotify.com/v1/me", {
        headers: { Authorization: `Bearer ${token}` }
    });
    const profile = await profileRes.json();
    const profileDiv = document.getElementById("profile");
    profileDiv.innerHTML = `
        <img src="${profile.images?.[0]?.url || 'https://via.placeholder.com/80'}" alt="Profile">
        <h3>${profile.display_name}</h3>
    `;

    // PLAYLISTS
    const playlistsRes = await fetch("https://api.spotify.com/v1/me/playlists", {
        headers: { Authorization: `Bearer ${token}` }
    });
    const playlistsData = await playlistsRes.json();
    const playlistsDiv = document.getElementById("playlists");

    playlistsDiv.innerHTML = playlistsData.items.map(p => `
        <div class="playlist" onclick="playPlaylist('${p.id}')">
            <strong>${p.name}</strong> - ${p.tracks.total} tracks
        </div>
    `).join('');
}

// Play playlist when clicked
async function playPlaylist(playlistId) {
    const token = localStorage.getItem("access_token");
    
    // Get first 10 tracks of playlist
    const res = await fetch(`https://api.spotify.com/v1/playlists/${playlistId}/tracks?limit=10`, {
        headers: { Authorization: `Bearer ${token}` }
    });
    const data = await res.json();
    const searchResultsDiv = document.getElementById("searchResults");

    if(data.items?.length) {
        searchResultsDiv.innerHTML = data.items.map(item => {
            const track = item.track;
            return `
                <div class="search-result">
                    <strong>${track.name}</strong> by ${track.artists.map(a => a.name).join(", ")}
                    <br>
                    <iframe 
                        src="https://open.spotify.com/embed/track/${track.id}" 
                        width="300" 
                        height="80" 
                        frameborder="0" 
                        allowtransparency="true" 
                        allow="encrypted-media">
                    </iframe>
                </div>
            `;
        }).join('');
    } else {
        searchResultsDiv.innerHTML = "<p>No tracks in this playlist.</p>";
    }
}

async function searchSpotify() {
    const query = document.getElementById("searchInput").value;
    if (!query) return alert("Please enter a search term.");

    const token = localStorage.getItem("access_token");
    const res = await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(query)}&type=track&limit=10`, {
        headers: { Authorization: `Bearer ${token}` }
    });
    const data = await res.json();
    const resultsDiv = document.getElementById("searchResults");
    
    if(data.tracks?.items?.length) {
        resultsDiv.innerHTML = data.tracks.items.map(track => `
            <div class="search-result">
                <strong>${track.name}</strong> by ${track.artists.map(a => a.name).join(", ")}
                <br>
                <iframe 
                    src="https://open.spotify.com/embed/track/${track.id}" 
                    width="300" 
                    height="80" 
                    frameborder="0" 
                    allowtransparency="true" 
                    allow="encrypted-media">
                </iframe>
            </div>
        `).join('');
    } else {
        resultsDiv.innerHTML = "<p>No results found.</p>";
    }
}

loadDashboard();
</script>


</body>
</html>



